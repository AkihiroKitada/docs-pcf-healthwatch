---
title: Monitoring Certificate Expiration
owner: Healthwatch
---

This topic describes how to monitor the expiration of Ops Manager certificates using metrics
collected by the Healthwatch Exporter for VMware Tanzu Application Service for VMs (TAS for
VMs) and Healthwatch Exporter for Tanzu Kubernetes Grid Integrated Edition (TKGI) tiles.


## <a id='overview'></a> Overview of Certificate Expiration Monitoring

The Certificate Expiration dashboard in the Grafana user interface (UI) shows when Ops Manager certificates are due to expire. These certificates include the Ops Manager root certificate authority (CA) as well as leaf certificates for product tiles and BOSH deployments that are stored in BOSH CredHub. For more information about these certificates, see [Certificate
Types](https://docs.pivotal.io/ops-manager/security/pcf-infrastructure/certificate-types.html)
in the Ops Manager documentation.

The certificates in the Certificate Expiration dashboard come from two sources: the certificate expiration metric exporter VM and the BOSH Director tile's list of trusted certificates.

The certificate expiration metric exporter VM, `cert-expiration-exporter`, is deployed by the Healthwatch exporters. It uses the `om` CLI to make a GET request to the
`/api/v0/deployed/certificates` Ops Manager API endpoint with the query parameter `?expires_within=1y`.
This request returns all certificate expiration dates that are due to occur within one year.
You cannot configure the certificate expiration metric exporter VM to make a request to the
Ops Manager API endpoint that specifies a different time period. For more information, about
the `/api/v0/deployed/certificates` endpoint, see [Getting Information About Certificates from
Products](https://docs.pivotal.io/platform/2-10/opsman-api/#tag/Certificates/paths/~1api~1v0~1deployed~1certificates/get)
in the Ops Manager API documentation.

In addition, the BOSH Director tile contains a **Trusted Certificates** field where you can enter your custom CA certificates to allow all BOSH-deployed components in your deployment to trust custom root certificates. For more information about this field, see [Setting Trusted Certificates](https://docs.pivotal.io/ops-manager/2-10/trusted-certificates.html).

If any CAs and leaf certificates for your deployment are due to expire soon, rotate them before
they expire to avoid downtime for your deployment. To rotate CAs and leaf certificates, see
[Overview of Certificate Rotation](https://docs.pivotal.io/ops-manager/security/pcf-infrastructure/api-cert-rotation.html)
in the Ops Manager documentation.


## <a id='configure-static-ip'></a> Reserving a Static IP Address for the Certificate Expiration Metric Exporter VM

You do not need to configure the certificate expiration metric exporter VM for it to collect
certificate expiration metrics. However, you can reserve a static IP address for the certificate
expiration metric exporter VM.

To configure a static IP address for the certificate expiration metric exporter VM, see the
configuration topic for your Healthwatch Exporter tile:

* [(Optional) Configure TAS for VMs Metric Exporter VMs](../configuring-exporter-tas.html#exporter-config) in _Configuring
Healthwatch Exporter for TAS for VMs_.

* [(Optional) Configure TKGI and Certificate Expiration Metric Exporter VMs](../configuring-exporter-tkgi.html#exporter-config)
in _Configuring Healthwatch Exporter for TKGI_.
