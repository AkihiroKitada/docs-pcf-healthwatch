---
title: Installing and Configuring PCF Healthwatch
owner: PCF Healthwatch
---

This topic describes how to install and configure Pivotal Cloud Foundry (PCF) Healthwatch. For a list of compatible Ops Manager and Pivotal Application Service (PAS) versions, see [Product Snapshot](index.html#snapshot).


## <a id='install'></a> Install PCF Healthwatch

1. Download the product file from [Pivotal Network](https://network.pivotal.io/products/p-healthwatch).

1. Navigate to the Ops Manager Installation Dashboard and click **Import a Product** to upload the product file.
Â 
1. Under the **Import a Product** button, click **+** next to the version number of PCF Healthwatch. This adds the tile to your staging area.


## <a id='configure'></a> Configure PCF Healthwatch

To start using PCF Healthwatch, you need to configure the Ops Manager Director and PCF Healthwatch tiles.

Ops Manager no longer requires you to create a separate network as a Service Network and allows you to designate your existing networks as a Service Network for tiles.
BOSH handles the IP allocation in [Ops Manager 2.1+](https://docs.pivotal.io/pivotalcf/2-1/pcf-release-notes/opsmanager-rn.html#ip-discontinued), so there are no longer concerns about IP collisions with on-demand services.

You can use any of your networks as the Service Network in the following configuration.

### <a id='ops-man'></a> Step 1. Configure the Ops Manager Director Tile

<p class="note"><strong>Note:</strong> If you have already completed this step during a prior installation of PCF Healthwatch, you do not need to repeat it.</p>

To configure the Ops Manager Director tile, do the following:

1. Click the **Ops Manager Director** tile on the Ops Manager Installation Dashboard.

1. Navigate to **Create Networks** and click **Add Network**.

1. In the **Name** field, enter a name for the service network.

1. Enter the network details for your **Service Network**.

1. Click **Save**.
              
### <a id='healthwatch-tile'></a> Step 2. Configure the PCF Healthwatch Tile

To configure the PCF Healthwatch tile, do the following:

1. Click the **PCF Healthwatch** tile on the Ops Manager Installation Dashboard.

1. Navigate to **Assign AZs and Networks** and do the following:
    1. Select an Availability Zone (AZ) for placing singleton jobs.
    1. Select one or more AZs for balancing other jobs.
		<p class="note"><strong>Note:</strong> To create a highly available environment, Pivotal recommends selecting multiple AZs.</p>
    1. Select **Network** for installing PCF Healthwatch.
    1. Select **Service Network** for running the BOSH Health Check VM.
    1. Click **Save**.

1. Navigate to **Healthwatch Component Config** and do the following:      
  1. Optional: Enter a foundation name for this PCF. The entered name is emitted as a tag on all Firehose metrics generated by PCF Healthwatch. If no name is set, then PCF Healthwatch defaults to using the system domain as the foundation name label when publishing its metrics. Do not use any of the special characters `!`, `@`, `#`, `^`, `&`, `$`, `%` , `*`, parentheses or quotes in the chosen name. Use of `-`, `_` or space is allowed.
	1. Set **Ingestor Count** to the number of Doppler Server instances configured in the PAS tile. Evaluate performance by monitoring the number of [ingestor disonnects](monitoring.html#firehose-disconnect). Consistent disconnects is an indicator of too few ingestor instances.
	1. Set **Redis Worker Count** to the number of Doppler Server instances configured in the PAS tile. If the data being displayed in the PCF Healthwatch UI is regularly delayed by more than one-minute, scale up the number of instances.
	1. To prevent sending events to the Event Alerts tile (EVA), deselect **Publish events to Event Alerts Tile**. All events will still be calculated and stored in the `alert` table.
	1. Click **Save**.
	<p class="note"><strong>Note:</strong> In the default highly available installation, PCF Healthwatch requires up to 20&nbsp;GB of free RAM on Diego for steady-state operations and up to 40&nbsp;GB of RAM during deployments.  You can lower this footprint by reducing the instance counts in this section. <br/>
    Failure to have enough available RAM on Diego typically results in the <a href='./troubleshooting.html#insufficient-resources'>Insufficent Resources</a> error message when running the <b>push-apps</b> errand.</p>

1. Navigate to **Health Check** and do the following:
	1. Enter **Ops Manager URL**. The URL should include the protocol. This URL must be reachable from a `cf pushed` application.
	1. In **BOSH Health Check Availability Zone**, select an AZ for the BOSH Health Check VM.
	<p class="note"><strong>Note:</strong> On Azure environments this dropdown will be null as Azure does not yet have the concept of AZs.</p>
	1. In **BOSH Health Check VM Type**, select a VM type for the BOSH Health Check VM. The recommended VM type is **small**.
	1. (Optional) Enter your **UAA Client User** and **UAA Client Secret** for BOSH Task Check. If you have two-factor authentication enabled on the BOSH Director, create a BOSH UAA client with the following steps on the BOSH UAA server:
	     1. To target the BOSH UAA and log in with an admin credential, see [Creating UAA Clients for BOSH Director](https://docs.pivotal.io/pivotalcf/2-0/customizing/opsmanager-create-bosh-client.html). For SSO-enabled Directors, enter the following command: ```uaac token sso get DIRECTOR_UAA_LOGIN_USERNAME```
	     1. Create a UAA client for the BOSH Task Check by entering the following command: ```uaac client add CLIENT_NAME --authorized_grant_types 
	      client_credentials --authorities bosh.read --secret CLIENT_SECRET```
	1. Click **Save**.

1. Return to the Ops Manager Installation Dashboard and click **Apply Changes**.


## <a id='healthwatch-opsman'></a> (Optional) Disable Ops Manager Continuous Validation Testing

PCF Healthwatch continuously validates the health of Ops Manager. You may want to disable this test suite if, for example, you are using BOSH instead of Ops Manager to deploy PCF software. This can be accomplished either via the Ops Manager UI or BOSH manifest.

To disable the Ops Manager test suite via Ops Manager UI (an option available as of v1.1.4), do the following:

1. Click the **PCF Healthwatch** tile on the Ops Manager Installation Dashboard.

1. Navigate to **Health Check** section.

1. Select the **Disable** radio button in the **Ops Manager Validation Testing** field.

To disable the Ops Manager test suite via BOSH manifest, do the following:

1. In your BOSH manifest, set the `healthchecker.opsman.disable` property to `true`.

1. Redeploy PCF Healthwatch and run the `push-apps` errand.

When you turn the test suite off, the following changes happen:

* The `opsmanager-health-check` testing app is not deployed.
* The Ops Manager Health panel is not displayed in the PCF Healthwatch UI.
* The [Ops Manager Health metric](metrics.html#opsman) is not created and emitted.


## <a id='healthwatch-uaa-users'></a> (Optional) Allow Additional Users to Access the PCF Healthwatch UI

Any user with the `healthwatch.read` or `healthwatch.admin` scope can access the PCF Healthwatch UI. The UAA admin user has both of these scopes by default.

To allow other users read-only access to the Healthwatch UI, perform the following steps. This procedure adds the `healthwatch.read` scope to the desired UAA users using the uaac client.

1. Access the uaac client with `uaac target UAA-URL`.

1. Enter `uaac token client get UAA-ADMIN-CLIENT-USERNAME`. When prompted, enter the secret.

1. Optional: Add new UAA users using `uaac user add NEW-USER-USERNAME --emails NEW-USER-EMAIL-ADDRESS`. When prompted, enter the password.

1. Enter `uaac member add healthwatch.read UAA-USERNAME` to add the scope to the user.

The above procedure can be leveraged to add the `healthwatch.admin` scope as well.

<p class="note"><strong>Note:</strong> Only users that should be allowed to change settings in Healthwatch should be granted the healthwatch.admin scope. In v1.2, this scope allows a user to alter the default alerting threshold values for the entire product. In future versions of Healthwatch, this user scope may be allowed additional configuration capabilities. As such, this Admin scope should not be granted to any user you wish to remain read-only access.</p>


## <a id='healthwatch-migration-v1-1'></a> (Optional) Migrate Data From PCF Healthwatch v1.1

PCF Healthwatch v1.2 aggregates all metric data. This change requires you to use a new set of database tables called `value_metric_agg` and `counter_event_agg`. After installing PCF Healthwatch v1.2, you can migrate all of the data from the previous 24 hours to new tables.

This migration is a hidden errand that you must run with the BOSH CLI.

<p class="note"><strong>Note:</strong> Depending on the size of your foundation, the migration can take anywhere from a few minutes to several hours.</p>


## <a id='migrating-between-versions'></a> Migrating Data Between Versions

1. SSH into the Ops Manager VM by following the instructions in [SSH into Ops Manager](https://docs.pivotal.io/pivotalcf/2-1/customizing/trouble-advanced.html#ssh).

1. Copy the `Bosh Commandline Credentials` credential from the Director tile in Ops Manager's UI.

1. From the Ops Manager VM, run `BOSH-COMMANDLINE-CREDENTIALS deployments` to get the PCF Healthwatch deployment name.

1. From the Ops Manager VM, run `BOSH-COMMANDLINE-CREDENTIALS -d PCF-HEALTHWATCH-DEPLOYMENT-NAME run-errand migrate-v1.1-v1.2`.

1. After the errand completes, verify the data exists for 24 hours in the Router Performance Detail page graphs.

To troubleshoot unpredictable behavior, SSH into the errand VM and check the logs in `/var/vcap/sys/log/migration_v1.1_v1.2/`.

<p class="note"><strong>Note:</strong> After the data migration completes, the v1.1 database tables <code>value_metric</code> and <code>counter_event</code> are deleted from the database.</p>