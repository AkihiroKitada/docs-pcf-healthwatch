---
title: Troubleshooting PCF Healthwatch
owner: PCF Healthwatch
---

<strong><%= modified_date %></strong>

This topic describes how to resolve common issues with Pivotal Cloud Foundry (PCF) Healthwatch.

## <a id='insufficient-resources'></a>Insufficient Memory Resources

Insufficient capacity of Diego cells can cause issues when you install or upgrade PCF Healthwatch.

### Error

The `push-apps` errand fails with a message similar to the following:

<pre class="terminal">
$ /var/vcap/packages/cf-cli/bin/cf start healthwatch-blue  
Starting app healthwatch-blue in org system / space healthwatch as admin...  
FAILED  
InsufficientResources
</pre>

### Cause

Diego cells do not have enough resources available to run the PCF Healthwatch apps. 

### Solution

To resolve this issue, navigate to the **Resource Config** pane of the Pivotal Application Service (PAS) tile and increase the number of **Diego Cell** instances.  Alternatively, if you do not require high availability, scale down the number of instances in the **Component Config** section of the PCF Healthwatch tile.

## <a id='memory-limit'></a>Memory Limit Errors

Insufficient memory allocation can cause issues when you install or upgrade PCF Healthwatch.

### Error

If a PCF environment exceeds the total memory limit set for the `healthwatch` space in the `system` org, the PCF Healthwatch `push-apps` errand can fail. When this occurs, the error message looks similar to the following:

<pre class="terminal">
$ /var/vcap/packages/cf-cli/bin/cf start cf-health-check
Starting app cf-health-check in org system / space healthwatch as admin...
FAILED
Server error, status code: 400, error code: 100005, message: You have exceeded your organization's memory limit: app requested more memory than available
</pre>

### Cause

Your PCF environment has an insufficient total memory quota set for the `healthwatch` space in the `system` org.

The issue should not occur if the Apps Manager errand has run in your environment. Because service tiles use the `system` org to execute smoke tests, the Apps Manager errand sets the default `system` org quota to `runaway`. If the Apps Manager errand has not run or failed, the default `system` quota may not be reset properly.

### Solution

To resolve this issue, you can set the default memory quota for the `healthwatch` space in the `system` org to at least 24 GB and re-run the `push-apps` errand manually.

## <a id='opsman-health'></a>Ops Manager Health Check Errors

The Opsmanager Health Check needs the ability to reach Ops Manager on the underlying network.

### Error

This error will appear as constantly failing Ops Manager Health Checks on the Dashboard and `Ops Manager Health Check History` page even though Ops Manager is running.

### Cause

The `opsmanager-health-check` application attempts to connect to Ops Manager in order to verify it is running.  This application needs the correct network settings in order to be able to reach the Ops Manager VM.  If there are firewall rules in place that prevent the network access then this check will continually fail.

### Solution

To determine if the `ops-manager-health-check` app  can reach the Ops Manager VM, do the following:

1. Run `cf ssh opsmanager-health-check` to SSH into the running instance. 
1. Run `curl -k -v $OPSMANAGER_URL` to check the network access.

If the steps above are not successful and you cannot modify network access to allow the `opsmanager-health-check` app to reach Ops Manager, the test cannot execute successfully. In that case, follow the steps to [Disable Ops Manager Continuous Validation Testing](installing.html#healthwatch-opsman).


## <a id='bosh-health'></a>BOSH Health Check Failing After Upgrade

### Error

`ERROR: Bosh health check failed to delete deployment "bosh-health-check": Deployment not found`

### Cause

In PCF Healthwatch 1.2.2 and later, PCF Healthwatch uses service broker UAA credentials for the BOSH Health Check. This causes a permission issue if the BOSH Health Check deployment already exists on the Director.

### Solution

Manually delete the existing BOSH Health Check deployment.


## <a id='bosh-metric-ingestion'></a>Smoke Tests Failing on Bosh Metric Ingestion

### Error

`[Fail] Bosh metric ingestion [It] Ingests metrics from the director into mysql /var/vcap/packages/healthwatch-data/src/github.com/pivotal-cf/healthwatch-data/data-ingestion/smoketests/bosh_metrics_test.go:50`

<p class="note"><strong>Note</strong>: A symptom of this error is a red <b>Job Health</b> panel with no failing jobs noted on the PCF Healthwatch dashboard.</p> 

### Cause

The PCF Healthwatch smoke tests errand validates the storage of BOSH system metrics in the PCF Healthwatch database. The errand most often fails because of a bug in earlier versions of Ops Manager that causes the BOSH system metrics forwarder process to fail. This bug is present in Ops Manager versions earlier than v2.1.4. 

### Solution

To resolve this issue, upgrade Ops Manager to v2.1.4 or later. You can then validate that there are BOSH system metrics in the Firehose by running `cf nozzle -n | grep system`.  This displays metrics such as `system.healthy` and `system.cpu.user` about every 30 seconds.